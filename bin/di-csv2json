#!/usr/bin/env python3

import click
import dataiter as di
import re

from pathlib import Path

@click.command()
@click.option("-f", "--force", is_flag=True, default=False, help="Overwrite existing file")
@click.argument("file", nargs=-1, type=click.Path(exists=True))
def main(force, file):
    """Convert CSV file to JSON file."""
    for input in file:
        output = re.sub(r"\.(csv|CSV)$", "", input) + ".json"
        click.echo(f"{input} â†’ {output}")
        if Path(output).exists() and not force:
            raise SystemExit(
                f"Output file {output} exists, "
                f"use -f/--force to overwrite")
        data = di.DataFrame.read_csv(input)
        data.write_json(output)

if __name__ == "__main__":
    main()
